# 智能床垫动态高度调节系统功能说明

## 系统概述
这是一个基于WebSocket的智能床垫实时监测与动态气囊高度调节系统，实现了高精度压力传感器数据可视化、智能睡眠姿态识别、34个气囊的动态高度控制，以及基于人工智能算法的自动支撑调节功能。

## 核心功能特性

### 1. 高精度连续热力图系统 (40×26网格)
- **功能**: 以高精度连续色彩热力图形式展示1040个压力传感器的实时数据
- **压力范围**: 支持0-140数值范围的精确映射
- **色彩编码** (11级连续渐变):
  - 深蓝色 (0): 无压力
  - 蓝色 (14): 极轻压力
  - 浅蓝 (28): 轻压
  - 青色 (42): 轻中压
  - 青绿 (56): 中等压力
  - 绿色 (70): 中高压
  - 黄绿 (84): 较高压力
  - 黄色 (98): 高压
  - 橙色 (112): 很高压力
  - 红橙 (126): 极高压力
  - 深红色 (140+): 最高压力
- **技术实现**: HSV色彩空间插值算法，平滑连续过渡
- **交互**: 鼠标悬停显示精确位置坐标和压力数值

### 2. 34个气囊动态高度调节系统
- **气囊数量**: 34个不连续编号气囊的精确控制
- **气囊分布**:
  - 🟢 21个绿色圆形气囊: 中央身体支撑区域
  - 🔴 9个红色圆形气囊: 侧边支撑区域
  - 🟢 3个绿色大型矩形气囊: 头部/颈肩/上背区域
  - 🔴 1个红色矩形气囊: 腿部区域
- **高度控制**:
  - 连续调节范围: 0-100%
  - 精度: 1%增量
  - 实时响应: <100ms
- **控制方式**:
  - 滑动条连续调节
  - 快捷按钮: 关闭(0%)/中档(50%)/高档(100%)
  - 批量操作: 全部中等高度/全部复位
- **视觉反馈**: 高度越高发光效果越强，颜色深度动态变化

### 3. 智能压力-高度映射算法
- **算法类型**: 基于人体工程学的分区域支撑策略
- **身体分区**:
  - 头部区域 (气囊40,41,42): 基础高度20%，压力系数0.3
  - 肩背区域 (气囊32,33,34,35,43): 基础高度40%，压力系数0.5
  - 腰部区域 (气囊24,25,26,27): 基础高度60%，压力系数0.8
  - 背部中段 (气囊36,37,38,39): 基础高度50%，压力系数0.6
  - 下背部 (气囊28,29,30,31): 基础高度55%，压力系数0.7
  - 腿部区域 (气囊20,21,22,23,12): 基础高度30%，压力系数0.4
  - 侧边支撑 (气囊14,4,5,16,17,8,9,0,1): 基础高度35%，压力系数0.4
- **响应机制**:
  - 高压区域自动增加支撑高度
  - 无压力区域自动降低到30%基础高度
  - 平滑调节: 每次最大5%变化，避免突然调整
- **个性化因子**: 支撑模式和压力敏感度实时影响计算结果

### 4. 个性化智能设置系统
- **支撑模式选择**:
  - 软模式 (×0.7): 适合轻体重用户，提供柔和支撑
  - 平衡模式 (×1.0): 标准支撑，适合大多数用户
  - 硬模式 (×1.3): 适合重体重用户，提供强力支撑
- **压力敏感度调节**:
  - 调节范围: 10%-100%
  - 默认值: 70%
  - 实时生效: 调节后立即应用到智能算法
- **自动调节模式**:
  - 一键启用/停用智能自动调节
  - 实时状态指示: 开启(绿色)/关闭(红色)
  - 启用后每1.5秒自动分析压力并调节气囊高度

### 5. 睡眠姿态智能识别
- **支持姿态**:
  - 🛏️ 无人状态: 检测床垫无压力分布
  - 🛌 仰卧姿态: 识别平躺睡眠模式
  - 😴 侧卧姿态: 检测侧向睡眠姿态
- **识别算法**: 基于压力分布模式的机器学习识别
- **响应速度**: 实时识别，1.5秒更新周期

### 6. 高级实时监测指标系统
- **核心监测指标**:
  - 平均压力: 全床垫压力均值(实时计算，瞬时响应)
  - 压力指数(PI): 综合压力评估(无延迟)
  - 接触面指数: 可调节压力阈值(0-20)的接触面积百分比
  - 最大压力值: 实时峰值压力点(瞬时更新)
- **智能阈值系统**:
  - 压力阈值滑动条: 0-20数值范围精确调节
  - 实时接触面积计算: 超过阈值的传感器数量统计
  - 动态响应: 阈值调节后立即生效于所有计算
- **系统状态监控**:
  - WebSocket连接状态: 已连接/连接断开
  - 当前系统时间显示
  - 自动重连机制: 断线后5秒自动重连
- **性能优化特性**:
  - 消除数据延迟响应问题
  - 基于实时压力数组的瞬时计算
  - 移除服务器预计算依赖，提升响应速度

### 7. 先进的可视化控制界面
- **热力图显示**:
  - 1040个传感器点的实时渲染
  - 连续色彩映射无断层显示
  - 交互式悬停信息提示
- **压力矩阵完整显示系统**:
  - 40×26网格完整可视化(900px高度)
  - 精美Unicode边框装饰效果
  - 实时统计信息显示(总传感器/激活传感器/接触面百分比)
  - 可折叠/展开控制面板，节省屏幕空间
  - 平滑CSS动画过渡效果(0.3秒)
- **气囊控制面板**:
  - 34个气囊的网格化布局
  - 自适应响应式设计
  - 滚动区域支持大量气囊显示
  - 类型区分: 矩形气囊(绿框)/圆形气囊(蓝框)
- **设置面板**:
  - 现代化毛玻璃设计
  - 实时滑动条控件
  - 状态指示和视觉反馈
  - 压力阈值调节控制器

## 技术架构

### 前端技术栈
- **核心语言**: 纯JavaScript ES6+ (零外部依赖)
- **样式技术**: 现代CSS3 (Grid + Flexbox + 毛玻璃效果)
- **色彩算法**: HSV色彩空间数学插值
- **实时通信**: WebSocket API
- **响应式设计**: 移动端和桌面端自适应

### 后端服务
- **服务器**: Python asyncio WebSocket服务器
- **并发处理**: 多客户端异步连接支持
- **数据源**: JSON格式循环播放真实传感器数据
- **协议**: 标准WebSocket + JSON数据交换

### 通信协议
#### 服务器→客户端 (传感器数据)
```json
{
    "time": "2024-11-08 15:21:39",
    "side": "right", 
    "pressure": "[0,3,5,4,0,...]", // 1040个压力值
    "posture": "no|supine|side",
    "airbag_status": "close|open",
    "avg_pressure": "0.05",
    "PI": "0",
    "com_level": "80",
    "PAI": "[1.0,0.0,0.0,0.0,0.0]",
    "PL": "[0,3,5,4,0,...]", // 40个区域压力
    "airbag_time": "[0,0,0,0,0]",
    "data_status": "0"
}
```

#### 客户端→服务器 (气囊控制)
```json
{
    "airbag_heights": "{\"0\":25,\"1\":30,\"4\":45,...}", // 34个气囊高度
    "time": "5",
    "pressure_threshold": 5,  // 当前接触面阈值设置
    "real_time_metrics": {    // 实时计算的监测指标
        "avg_pressure": 15.2,
        "pressure_index": 23.1,
        "contact_index": 45.6,
        "max_pressure": 89
    }
}
```

## 部署与使用

### 系统要求
- Python 3.8+ 
- websockets库 ≥12.0
- 现代浏览器 (支持WebSocket和ES6+)
- 建议内存: 512MB+
- 建议CPU: 双核1GHz+

### 快速启动
```bash
# 1. 激活Python虚拟环境
source ../venv/bin/activate

# 2. 启动WebSocket服务器
python server.py

# 3. 浏览器打开客户端界面
open clients.html
```

### 操作指南
1. **观察压力分布**: 实时查看40×26热力图的颜色变化
2. **查看压力矩阵**: 完整展示1040个传感器数据，可折叠控制
3. **调节接触阈值**: 使用滑动条调节接触面指数的压力阈值(0-20)
4. **启用智能调节**: 点击"智能调节"按钮激活自动模式
5. **个性化设置**: 在设置面板调整支撑模式和敏感度
6. **手动微调**: 使用滑动条精确调节特定气囊高度
7. **监控状态**: 查看右侧实时指标和系统状态(瞬时响应)

### 高级功能
- **场景模式**: 软/平衡/硬三种预设支撑方案
- **敏感度调节**: 10%-100%压力响应灵敏度设置  
- **批量控制**: 一键设置所有气囊到中等高度或完全复位
- **实时反馈**: 气囊高度变化的动态视觉效果
- **阈值优化**: 0-20范围的接触面压力阈值精确调节
- **矩阵控制**: 压力矩阵展示的折叠/展开空间管理
- **瞬时计算**: 基于实时数据的无延迟指标计算

## 系统优势

### 技术创新
- **高精度映射**: 0-140连续数值的无级色彩编码
- **智能算法**: 人体工程学7区域差异化支撑策略
- **实时响应**: 毫秒级气囊高度调节响应
- **个性定制**: 支撑偏好的深度个性化配置
- **瞬时监测**: 消除延迟的实时指标计算系统
- **阈值智能**: 可调节压力阈值的接触面识别
- **完整可视**: 1040传感器矩阵的完整展示能力

### 用户体验
- **直观可视**: 热力图压力分布一目了然
- **简单操作**: 滑动条和按钮的直观控制方式
- **智能便捷**: 一键启用全自动智能调节
- **美观界面**: 现代化渐变设计和毛玻璃效果
- **空间管理**: 可折叠矩阵显示，灵活空间利用
- **实时反馈**: 瞬时响应的指标更新，无延迟体验
- **精确控制**: 压力阈值的精细化调节能力

### 系统性能
- **高效渲染**: 1040传感器实时更新无卡顿
- **瞬时计算**: 监测指标响应时间<10ms
- **低延迟**: WebSocket通信延迟<10ms
- **稳定可靠**: 异常处理和自动重连机制
- **资源友好**: 内存占用<30MB，CPU使用率<1%
- **动画流畅**: 0.3秒CSS过渡动画，视觉体验优秀

### 扩展性
- **模块化架构**: 便于新功能集成和维护
- **标准协议**: WebSocket和JSON标准化通信
- **开放接口**: 支持第三方系统集成
- **配置灵活**: 气囊数量和区域映射可调整

## 应用场景
- **家庭睡眠**: 个人和家庭智能床垫系统
- **医疗康复**: 医院和康复中心的压疮预防
- **酒店服务**: 高端酒店的睡眠质量提升
- **科研实验**: 睡眠研究和人体工程学实验
- **产品展示**: 智能床垫厂商的技术演示

这个系统代表了智能床垫技术的前沿水平，将压力感知、人工智能算法和用户体验设计完美融合，为用户提供了个性化、智能化的睡眠支撑解决方案。